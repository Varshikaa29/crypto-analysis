<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NEON GENESIS | Crypto Analytics</title>
    
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;500;700;900&family=Rajdhani:wght@300;500;700&family=Share+Tech+Mono&display=swap" rel="stylesheet">
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Phosphor Icons -->
    <script src="https://unpkg.com/@phosphor-icons/web"></script>

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        cyber: {
                            black: '#020204',
                            dark: '#0a0a12',
                            panel: '#13131f',
                            cyan: '#00f3ff',
                            pink: '#ff00ff',
                            green: '#0aff00',
                            yellow: '#fcee0a',
                            red: '#ff2a2a'
                        }
                    },
                    fontFamily: {
                        orbitron: ['Orbitron', 'sans-serif'],
                        rajdhani: ['Rajdhani', 'sans-serif'],
                        mono: ['Share Tech Mono', 'monospace'],
                    },
                    animation: {
                        'pulse-fast': 'pulse 1.5s cubic-bezier(0.4, 0, 0.6, 1) infinite',
                        'glitch': 'glitch 1s linear infinite',
                        'scanline': 'scanline 8s linear infinite',
                    },
                    keyframes: {
                        glitch: {
                            '2%, 64%': { transform: 'translate(2px,0) skew(0deg)' },
                            '4%, 60%': { transform: 'translate(-2px,0) skew(0deg)' },
                            '62%': { transform: 'translate(0,0) skew(5deg)' },
                        },
                        scanline: {
                            '0%': { transform: 'translateY(-100%)' },
                            '100%': { transform: 'translateY(100%)' }
                        }
                    }
                }
            }
        }
    </script>

    <style>
        body {
            background-color: #020204;
            color: #e2e8f0;
            overflow-x: hidden;
        }

        /* Cyberpunk Grid Background */
        .cyber-grid {
            background-image: 
                linear-gradient(rgba(0, 243, 255, 0.03) 1px, transparent 1px),
                linear-gradient(90deg, rgba(0, 243, 255, 0.03) 1px, transparent 1px);
            background-size: 40px 40px;
            perspective: 500px;
        }

        /* Glass Panel Effect */
        .glass-panel {
            background: rgba(19, 19, 31, 0.7);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.05);
            box-shadow: 0 4px 30px rgba(0, 0, 0, 0.5);
        }

        /* Neon Glows */
        .neon-text-cyan { text-shadow: 0 0 10px rgba(0, 243, 255, 0.5); }
        .neon-text-pink { text-shadow: 0 0 10px rgba(255, 0, 255, 0.5); }
        .neon-border-cyan { box-shadow: 0 0 15px rgba(0, 243, 255, 0.2), inset 0 0 10px rgba(0, 243, 255, 0.1); }
        
        /* CRT Scanline Overlay */
        .scanlines {
            background: linear-gradient(
                to bottom,
                rgba(255,255,255,0),
                rgba(255,255,255,0) 50%,
                rgba(0,0,0,0.2) 50%,
                rgba(0,0,0,0.2)
            );
            background-size: 100% 4px;
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            pointer-events: none;
            z-index: 50;
        }

        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #020204; }
        ::-webkit-scrollbar-thumb { background: #1f2937; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #00f3ff; }

        /* Loader Animation */
        .loader {
            width: 48px;
            height: 48px;
            border: 3px solid #FFF;
            border-radius: 50%;
            display: inline-block;
            position: relative;
            box-sizing: border-box;
            animation: rotation 1s linear infinite;
        }
        .loader::after {
            content: '';  
            box-sizing: border-box;
            position: absolute;
            left: 50%;
            top: 50%;
            transform: translate(-50%, -50%);
            width: 40px;
            height: 40px;
            border-radius: 50%;
            border: 3px solid transparent;
            border-bottom-color: #00f3ff;
        }
        @keyframes rotation {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Decorative Corners */
        .corner-bracket {
            position: absolute;
            width: 8px;
            height: 8px;
            border-color: #00f3ff;
            border-style: solid;
            transition: all 0.3s ease;
        }
        .group:hover .corner-bracket {
            border-color: #ff00ff;
            width: 12px;
            height: 12px;
        }
        .corner-tl { top: 0; left: 0; border-width: 2px 0 0 2px; }
        .corner-tr { top: 0; right: 0; border-width: 2px 2px 0 0; }
        .corner-bl { bottom: 0; left: 0; border-width: 0 0 2px 2px; }
        .corner-br { bottom: 0; right: 0; border-width: 0 2px 2px 0; }

        .hidden { display: none !important; }
    </style>
</head>
<body class="antialiased min-h-screen relative font-rajdhani">

    <!-- Background Effects -->
    <div class="fixed inset-0 cyber-grid -z-10"></div>
    <div class="fixed inset-0 bg-gradient-to-t from-cyber-black via-transparent to-transparent -z-10"></div>
    <div class="scanlines opacity-20"></div>

    <!-- Header -->
    <header class="sticky top-0 z-40 border-b border-white/10 glass-panel">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex items-center justify-between h-20">
                <!-- Logo -->
                <div class="flex items-center gap-3">
                    <div class="relative w-10 h-10 flex items-center justify-center bg-cyber-cyan/10 border border-cyber-cyan rounded-sm">
                        <i class="ph-fill ph-cpu text-2xl text-cyber-cyan animate-pulse"></i>
                    </div>
                    <div class="flex flex-col">
                        <h1 class="text-2xl font-orbitron font-bold tracking-wider text-white">
                            NEON <span class="text-cyber-cyan neon-text-cyan">GENESIS</span>
                        </h1>
                        <span class="text-xs font-mono text-cyber-cyan/60 tracking-[0.2em] uppercase">System v2.4.0</span>
                    </div>
                </div>

                <!-- Search & Actions -->
                <div class="flex items-center gap-4">
                    <div class="hidden md:flex relative">
                        <input type="text" id="searchInput" placeholder="SEARCH_DATABASE..." 
                            class="w-64 bg-cyber-black/50 border border-white/10 rounded-sm py-2 pl-10 pr-4 text-sm font-mono focus:outline-none focus:border-cyber-cyan focus:ring-1 focus:ring-cyber-cyan transition-all placeholder-gray-600">
                        <i class="ph ph-magnifying-glass absolute left-3 top-2.5 text-gray-500"></i>
                    </div>
                    
                    <button onclick="app.refreshData()" id="refreshBtn" class="p-2 text-gray-400 hover:text-cyber-cyan hover:bg-cyber-cyan/10 rounded transition-colors group relative">
                        <i class="ph-bold ph-arrows-clockwise text-xl group-hover:rotate-180 transition-transform duration-500"></i>
                    </button>

                    <div class="h-8 w-px bg-white/10 mx-2"></div>

                    <div class="flex bg-cyber-black/50 rounded p-1 border border-white/10">
                        <button onclick="app.setView('grid')" id="viewGridBtn" class="p-1.5 rounded text-cyber-cyan bg-white/10 transition-all">
                            <i class="ph-fill ph-squares-four"></i>
                        </button>
                        <button onclick="app.setView('list')" id="viewListBtn" class="p-1.5 rounded text-gray-500 hover:text-white transition-all">
                            <i class="ph-fill ph-list-dashes"></i>
                        </button>
                    </div>
                </div>
            </div>
        </div>
        <!-- Stats Bar -->
        <div class="border-t border-white/5 bg-cyber-black/80 backdrop-blur-sm">
            <div class="max-w-7xl mx-auto px-4 py-1 flex items-center justify-between text-xs font-mono text-gray-500">
                <div class="flex gap-4">
                    <span class="flex items-center gap-1.5">
                        <span class="w-1.5 h-1.5 rounded-full bg-cyber-green animate-pulse"></span>
                        NET_STATUS: ONLINE
                    </span>
                    <span class="flex items-center gap-1.5" id="apiStatus">
                        <span class="w-1.5 h-1.5 rounded-full bg-cyber-cyan"></span>
                        SOURCE: COINGECKO API
                    </span>
                </div>
                <div class="flex gap-4 uppercase tracking-wider">
                    <span id="lastUpdated">UPDATED: --:--:--</span>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8 relative min-h-[calc(100vh-140px)]">
        
        <!-- Loading State -->
        <div id="loadingState" class="absolute inset-0 z-50 flex flex-col items-center justify-center bg-cyber-black/80 backdrop-blur-sm">
            <span class="loader mb-4"></span>
            <p class="font-mono text-cyber-cyan animate-pulse">ESTABLISHING UPLINK...</p>
        </div>

        <!-- Error/Status Toast -->
        <div id="toast" class="fixed bottom-8 right-8 z-50 transform translate-y-20 opacity-0 transition-all duration-300">
            <div class="glass-panel border-l-4 border-cyber-yellow p-4 rounded shadow-2xl flex items-start gap-3 max-w-sm">
                <i class="ph-fill ph-warning text-cyber-yellow text-xl mt-0.5"></i>
                <div>
                    <h4 class="font-orbitron text-sm font-bold text-cyber-yellow">SYSTEM ALERT</h4>
                    <p class="text-xs text-gray-300 font-mono mt-1" id="toastMessage">Rate limit exceeded. Switching to simulation mode.</p>
                </div>
            </div>
        </div>

        <!-- Dashboard Grid -->
        <div id="coinGrid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6 transition-opacity duration-300 opacity-0">
            <!-- Coin cards will be injected here -->
        </div>
    </main>

    <!-- Templates (Hidden) -->
    <template id="cardTemplate">
        <div class="group relative glass-panel rounded-xl p-5 hover:bg-white/[0.02] transition-all duration-300 hover:-translate-y-1">
            <!-- Corners -->
            <div class="corner-bracket corner-tl"></div>
            <div class="corner-bracket corner-tr"></div>
            <div class="corner-bracket corner-bl"></div>
            <div class="corner-bracket corner-br"></div>
            
            <!-- Hover Glow -->
            <div class="absolute inset-0 bg-cyber-cyan/5 opacity-0 group-hover:opacity-100 transition-opacity rounded-xl pointer-events-none"></div>

            <div class="relative z-10">
                <div class="flex justify-between items-start mb-4">
                    <div class="flex items-center gap-3">
                        <div class="relative">
                            <div class="absolute inset-0 bg-cyber-cyan blur-md opacity-20 rounded-full group-hover:opacity-40 transition-opacity"></div>
                            <img class="coin-img w-10 h-10 rounded-full relative object-cover border border-white/10" src="" alt="">
                        </div>
                        <div>
                            <h3 class="coin-symbol font-orbitron font-bold text-white tracking-wide"></h3>
                            <p class="coin-name text-xs text-gray-500 font-mono uppercase"></p>
                        </div>
                    </div>
                    <div class="coin-rank-badge px-2 py-0.5 rounded bg-white/5 border border-white/10 text-[10px] font-mono text-gray-400">
                        #<span class="coin-rank"></span>
                    </div>
                </div>

                <div class="mb-4">
                    <div class="flex items-end gap-2 mb-1">
                        <span class="text-xs text-gray-500 font-mono mb-1">$</span>
                        <span class="coin-price text-2xl font-rajdhani font-bold text-white"></span>
                    </div>
                    <div class="coin-change flex items-center gap-1 text-sm font-mono font-bold">
                        <i class="ph-bold trend-icon"></i>
                        <span class="change-value"></span>
                    </div>
                </div>

                <!-- Sparkline Container -->
                <div class="h-16 w-full relative overflow-hidden mb-4 border-b border-white/5">
                    <svg class="sparkline w-full h-full overflow-visible" preserveAspectRatio="none">
                        <!-- Path injected via JS -->
                    </svg>
                </div>

                <div class="grid grid-cols-2 gap-4 text-xs font-mono border-t border-white/5 pt-3">
                    <div>
                        <span class="text-gray-600 block mb-1">MARKET CAP</span>
                        <span class="coin-mcap text-gray-300"></span>
                    </div>
                    <div class="text-right">
                        <span class="text-gray-600 block mb-1">VOLUME 24H</span>
                        <span class="coin-volume text-gray-300"></span>
                    </div>
                </div>
            </div>
        </div>
    </template>

    <script>
        // --- System State ---
        const app = {
            data: [],
            currency: 'usd',
            view: 'grid',
            isSimulation: false,
            
            // --- Core Functions ---
            async init() {
                this.renderLoading(true);
                try {
                    await this.fetchData();
                } catch (e) {
                    console.warn("Initial fetch failed, switching to fallback");
                    this.enableSimulationMode();
                }
                this.setupEventListeners();
                this.renderLoading(false);
            },

            async fetchData() {
                if (this.isSimulation) {
                    await this.mockDelay(800);
                    this.data = this.generateMockData();
                    this.render();
                    return;
                }

                try {
                    const response = await fetch(
                        `https://api.coingecko.com/api/v3/coins/markets?vs_currency=${this.currency}&order=market_cap_desc&per_page=50&page=1&sparkline=true&price_change_percentage=24h`
                    );

                    if (!response.ok) {
                        if (response.status === 429) throw new Error("RATE_LIMIT");
                        throw new Error("API_ERROR");
                    }

                    this.data = await response.json();
                    this.updateStatus(true);
                    this.render();
                } catch (error) {
                    this.showToast("Connection unstable. Activating Simulation Protocol.", "warning");
                    this.enableSimulationMode();
                }
            },

            async refreshData() {
                const btn = document.getElementById('refreshBtn').querySelector('i');
                btn.classList.add('animate-spin');
                await this.fetchData();
                setTimeout(() => btn.classList.remove('animate-spin'), 1000);
            },

            enableSimulationMode() {
                this.isSimulation = true;
                this.data = this.generateMockData();
                this.updateStatus(false);
                document.getElementById('apiStatus').innerHTML = `
                    <span class="w-1.5 h-1.5 rounded-full bg-cyber-pink animate-pulse"></span>
                    SOURCE: SIMULATION (OFFLINE)
                `;
                this.render();
            },

            // --- Mock Data Generator (Robust Fallback) ---
            generateMockData() {
                const coins = ['BTC', 'ETH', 'USDT', 'BNB', 'SOL', 'XRP', 'USDC', 'ADA', 'AVAX', 'DOGE', 'DOT', 'TRX', 'LINK', 'MATIC', 'WBTC', 'LTC', 'DAI', 'SHIB', 'BCH', 'LEO'];
                const names = ['Bitcoin', 'Ethereum', 'Tether', 'BNB', 'Solana', 'Ripple', 'USDC', 'Cardano', 'Avalanche', 'Dogecoin', 'Polkadot', 'Tron', 'Chainlink', 'Polygon', 'Wrapped Bitcoin', 'Litecoin', 'Dai', 'Shiba Inu', 'Bitcoin Cash', 'UNUS SED LEO'];
                
                return coins.map((symbol, i) => {
                    const price = Math.random() * (symbol === 'BTC' ? 60000 : 3000) + 10;
                    const change = (Math.random() * 20) - 10;
                    const history = Array.from({length: 30}, () => price * (0.8 + Math.random() * 0.4));
                    
                    return {
                        id: symbol.toLowerCase(),
                        symbol: symbol.toLowerCase(),
                        name: names[i],
                        market_cap_rank: i + 1,
                        image: `https://ui-avatars.com/api/?name=${symbol}&background=13131f&color=00f3ff&font-size=0.4`, // Fallback image
                        current_price: price,
                        price_change_percentage_24h: change,
                        market_cap: price * 10000000,
                        total_volume: price * 500000,
                        sparkline_in_7d: { price: history }
                    };
                });
            },

            // --- Rendering Logic ---
            render() {
                const grid = document.getElementById('coinGrid');
                const template = document.getElementById('cardTemplate');
                const searchTerm = document.getElementById('searchInput').value.toLowerCase();
                
                grid.innerHTML = ''; // Clear current
                
                const filteredData = this.data.filter(coin => 
                    coin.name.toLowerCase().includes(searchTerm) || 
                    coin.symbol.toLowerCase().includes(searchTerm)
                );

                filteredData.forEach(coin => {
                    const clone = template.content.cloneNode(true);
                    
                    // Populate Data
                    const img = clone.querySelector('.coin-img');
                    img.src = coin.image;
                    img.onerror = function() { this.src = `https://ui-avatars.com/api/?name=${coin.symbol}&background=13131f&color=00f3ff`; };

                    clone.querySelector('.coin-symbol').textContent = coin.symbol.toUpperCase();
                    clone.querySelector('.coin-name').textContent = coin.name;
                    clone.querySelector('.coin-rank').textContent = coin.market_cap_rank;
                    clone.querySelector('.coin-price').textContent = this.formatCurrency(coin.current_price);
                    clone.querySelector('.coin-mcap').textContent = this.formatCompact(coin.market_cap);
                    clone.querySelector('.coin-volume').textContent = this.formatCompact(coin.total_volume);

                    // Price Change logic
                    const changeEl = clone.querySelector('.coin-change');
                    const isUp = coin.price_change_percentage_24h >= 0;
                    const changeValue = Math.abs(coin.price_change_percentage_24h).toFixed(2) + '%';
                    
                    changeEl.classList.add(isUp ? 'text-cyber-green' : 'text-cyber-red');
                    clone.querySelector('.trend-icon').classList.add(isUp ? 'ph-trend-up' : 'ph-trend-down');
                    clone.querySelector('.change-value').textContent = changeValue;

                    // Sparkline SVG
                    const sparklineSvg = clone.querySelector('.sparkline');
                    const points = coin.sparkline_in_7d ? coin.sparkline_in_7d.price : [];
                    if (points.length > 0) {
                        const pathData = this.createSparklinePath(points, 300, 60);
                        const path = document.createElementNS("http://www.w3.org/2000/svg", "path");
                        path.setAttribute("d", pathData);
                        path.setAttribute("fill", "none");
                        path.setAttribute("stroke", isUp ? "#0aff00" : "#ff2a2a");
                        path.setAttribute("stroke-width", "2");
                        path.setAttribute("stroke-linejoin", "round");
                        path.setAttribute("stroke-linecap", "round");
                        // Add glow filter via style
                        path.style.filter = `drop-shadow(0 0 2px ${isUp ? '#0aff00' : '#ff2a2a'})`;
                        sparklineSvg.appendChild(path);
                    }

                    // Add click event for details (could expand later)
                    
                    grid.appendChild(clone);
                });

                // Update timestamps
                const now = new Date();
                document.getElementById('lastUpdated').textContent = `UPDATED: ${now.toLocaleTimeString()}`;

                // Fade in
                grid.classList.remove('opacity-0');
            },

            // --- Helper Functions ---
            createSparklinePath(data, width, height) {
                const min = Math.min(...data);
                const max = Math.max(...data);
                const range = max - min || 1;
                
                // Scale points
                const points = data.map((val, i) => {
                    const x = (i / (data.length - 1)) * width;
                    const y = height - ((val - min) / range) * height; // Invert Y for SVG
                    return `${x},${y}`;
                });

                return `M ${points.join(' L ')}`;
            },

            setView(mode) {
                this.view = mode;
                const grid = document.getElementById('coinGrid');
                const btnGrid = document.getElementById('viewGridBtn');
                const btnList = document.getElementById('viewListBtn');

                if (mode === 'grid') {
                    grid.className = 'grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6 transition-opacity duration-300';
                    btnGrid.className = 'p-1.5 rounded text-cyber-cyan bg-white/10 transition-all';
                    btnList.className = 'p-1.5 rounded text-gray-500 hover:text-white transition-all';
                } else {
                    grid.className = 'grid grid-cols-1 gap-4 transition-opacity duration-300';
                    btnList.className = 'p-1.5 rounded text-cyber-cyan bg-white/10 transition-all';
                    btnGrid.className = 'p-1.5 rounded text-gray-500 hover:text-white transition-all';
                }
            },

            renderLoading(isLoading) {
                const loader = document.getElementById('loadingState');
                if (isLoading) {
                    loader.classList.remove('hidden');
                } else {
                    loader.classList.add('hidden');
                }
            },

            showToast(message, type) {
                const toast = document.getElementById('toast');
                document.getElementById('toastMessage').textContent = message;
                toast.classList.remove('translate-y-20', 'opacity-0');
                setTimeout(() => {
                    toast.classList.add('translate-y-20', 'opacity-0');
                }, 5000);
            },

            updateStatus(isOnline) {
                // Logic already handled in enableSimulationMode, but could extend here
            },

            setupEventListeners() {
                document.getElementById('searchInput').addEventListener('input', () => this.render());
            },

            mockDelay(ms) {
                return new Promise(resolve => setTimeout(resolve, ms));
            },

            formatCurrency(num) {
                return new Intl.NumberFormat('en-US', { style: 'currency', currency: 'USD' }).format(num);
            },

            formatCompact(num) {
                return new Intl.NumberFormat('en-US', { notation: "compact", compactDisplay: "short" }).format(num);
            }
        };

        // Boot system
        document.addEventListener('DOMContentLoaded', () => {
            app.init();
        });
    </script>
</body>
</html>
